#!/usr/bin/env python

import sys
import os
import string
from subprocess import *

from optparse import OptionParser

# get options
parser = OptionParser()
parser.add_option("-i","--indir",
                  action="store",
                  default=os.getcwd(),
                  dest="indir",
                  help="Input directory")
parser.add_option("-d","--outdir",
                  action="store",
                  default=os.getcwd(),
                  dest="outdir",
                  help="Output directory")
parser.add_option("-o","--outfile",
                  action="store",
                  default="merged",
                  dest="outfile",
                  help="Output file name")

(options,args)=parser.parse_args()

# last unclaimed argument is used as input file
for arg in args:
    options.outfile=arg

# create the command with output file
command="hadd -f"+options.outfile+" "

# get the input files
files=os.listdir(options.indir)

for file in files:
    if (re.match(".root", file):
        command+=options.outdir+file+" "

print command

#cp = Popen(self.command, shell=True)  # execute command
# wait to see if copying is complete
#cp.wait()  # is this necessary?
